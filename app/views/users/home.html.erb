<nav class="navbar navbar-expand-lg navbar-dark navbar-custom " style="background-color:rgb(238 9 120)">
      <%= image_tag("superball.png", width: '50px') %>
      <a class="navbar-brand" href="#" style="margin-left:5px; font-size:25px;">Pokemon Eat</a>
      <div style="width:60%; margin-left:20%;">
        <%= form_with(url: "/search/" + params[:id].to_s, method: :get, local: true) do |form| %>
          <div style="display:inline;">
            <%= form.label :term, "Find", :class=>"col-lg-12 col-form-label col-form-label-lg padding", :style=>"display:inline; color:white;" %>
            <%= form.text_field :term, :id => 'search_term',:class=>"form-control", :style=>"display:inline; width:20%;"%>
          </div>
          <div style="display:inline;">
            <%= form.label :location, "Near", :class=>"col-lg-12 col-form-label col-form-label-lg padding", :style=>"display:inline; color:white;"%>
            <%= form.text_field :location, :id => 'search_location', :class=>"form-control insert-location", :style=>"display:inline; width:30%;"%>
          </div>
          <% if @search_error != nil%>
            <p><%= @search_error%></p>
          <% end%>
          <div style="display:inline;">
            <%= form.submit "Go" , :class=>"btn", :style=>"color:white; font-size:1.25rem;" %>
          </div>
        <% end %>
      </div>
      <div class="col-2 collapse navbar-collapse" id="navbarResponsive">
        <% if @user == nil %>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/welcome">Sign Up</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/welcome">Log In</a>
            </li>
          </ul>
        <% else %>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/user" style="font-size:1.25rem;">My Dashboard</a>
            </li>
          </ul>
        <% end %>
      </div>
</nav>





<div style="margin:0px; padding:0px; background-image:url('/assets/images/recommend-background.jpeg')">
  <div class="row" >
    <div style="width:100%;">
      <div class="card text-center" style="height: 300px;">
        <div class="card-body">
          <h3 class="card-title">GUESS</h3>
          <h4 class="card-text">Get restaurant based on your preference!</h4>
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#recommendModal" style="margin-top:50px;">
            Recommend
          </button>
        </div>
      </div>
    </div>

    
  </div>
</div>


<div class="container" style="margin-top:40px;">
  <h1 style=" font-family: 'Times New Roman', Times, serif; 
              display: flex; 
              align-items: center; 
              justify-content: center;">Trending Restaurants</h3>
  <div style="margin-bottom:10px; height:1px; border-top: solid #ACC0D8 1px;"></div>
  <div class="row justify-content-evenly">
      <% if @businesses != nil and @businesses.empty? == false%>   
        <% @businesses.each do |business| %>
          <div class="col-4"> 
            <div class="card mb-3" >
              <img src=<%= business["image_url"]%> class="card-img-top">
              <div class="card-body">
                <h5 class="card-title business"><%=link_to(business["name"], '/business/' + business["id"] ) %></h5>
                <div>
                  <% business["categories"].each do |e| %>
                    <p class="card-text" style="display:inline;">    
                      <%= e["title"] %>              
                    </p>
                  <% end %>
                </div>
                <div>
                  <% business["location"]["display_address"].each do |e| %>
                    <p class="card-text" style="display:inline;">    
                      <%= e %>              
                    </p>
                  <% end %>
                </div>
                <p class="card-text"><%= business["display_phone"] %></p>
                <p class="card-text"><%= business["rating"] %></p>
                <p class="card-text">
                  <%=link_to("Detail", '/business/' + business["id"] ) %>
                </p>
                <%# <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small>#</p> %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
  </div>
</div>

<div class="container" style="margin-top:80px;">
  <h1 style=" font-family: 'Times New Roman', Times, serif; 
              display: flex; 
              align-items: center; 
              justify-content: center;">Booked Events</h3>
  <div style="height:1px; border-top: solid #ACC0D8 1px;"></div>
  <div class="vw-50" style="margin-top:5px; width:100%;">
      <div class="card text-center" style="border:0px;">
        <div class="card-body">
          <h4 class="card-text">Find out events near you!</h4>
          <%= form_with(url: "/events/" + params[:id].to_s, method: :get, local: true) do |form| %>
          <div style="display:inline;">
            <%= form.label :location, "Let's Go To", :class=>"col-lg-12 col-form-label col-form-label-lg padding", :style=>"display:inline;"%>
            <%= form.text_field :location, :id => 'event_location', :class=>"form-control insert-location", :style=>"display:inline; width:50%;"%>
          </div>
          <div style="display:inline;">
            <%= form.submit "Go" , :class=>"btn btn-primary" %>
          </div>
          <% end %>
        </div>
      </div>
    </div>
  <div class="row justify-content-evenly">
      <% if @events != nil and @events.empty? == false%>   
        <% @events.each do |event| %>
          <div class="col-4"> 
            <div class="card mb-3" >
              <img src=<%= event["image_url"]%> class="card-img-top" style="overflow:hidden;">
              <div class="card-body">
                <h5 class="card-title business"><%=link_to(event["name"], '/event/' + event["id"].to_s ) %></h5>
                <div>
                  <p class="card-text" style="display:inline;">    
                    <%= event["category"] %>              
                  </p>
                </div>
                <div>
                  <% event["location"]["display_address"].each do |e| %>
                    <p class="card-text" style="display:inline;">    
                      <%= e %>              
                    </p>
                  <% end %>
                </div>
                <p class="card-text"><%= event["display_phone"] %></p>
                <p class="card-text">
                  <%=link_to("Detail", '/event/' + event["id"] ) %>
                </p>
                <%# <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small>#</p> %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
  </div>
</div>


<div class="container" style="padding-top:20px;">
  <% if @user == nil%>
    <h1 style=" font-family: 'Times New Roman', Times, serif; 
              display: flex; 
              align-items: center; 
              justify-content: center;">Please Log In or Sign Up to view Your Reviews</h3>
    <div style="height:1px; border-top: solid #ACC0D8 1px;"></div>
  <% elsif @user_reviews != []%>
    <h1 style=" font-family: 'Times New Roman', Times, serif; 
              display: flex; 
              align-items: center; 
              justify-content: center;">My Reviews</h3>
    <div style="height:1px; border-top: solid #ACC0D8 1px;"></div>
    <div class="row justify-content-evenly">
      <ul class="list-group list-group-flush" style="width:100%;">
        <% @user_reviews.each do |r|%>
          <li class="list-group-item">
            <p>For <%= r.business_id%></p>
            <p><%= r.review%></p> 
            <p><%= r.updated_at%></p>
          </li>
        <% end %>
      </ul>
    </div> 
  <% elsif @user_reviews == [] %>
     <div class="row justify-content-evenly">
      <h3>No reviews currently.</h3>
     </div>
  <% end %>
</div>



<!-- The Modal -->
<div class="modal fade" id="searchModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Search</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <%= form_with(url: "/search/" + params[:id].to_s, method: :get, local: true) do |form| %>
          <%= form.label :term, "Term:", :class=>"col-lg-12 col-form-label col-form-label-lg padding" %>
          <%= form.text_field :term, :class=>"form-control" %>
          <%= form.label :location, "Location:", :class=>"col-lg-12 col-form-label col-form-label-lg padding" %>
          <%= form.text_field :location, :class=>"form-control insert-location" %>
          <%= form.submit "Search" , :class=>"btn btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>



<!-- The Modal -->
<div class="modal fade" id="recommendModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Recommend</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
      <p><%= @question.question %><p>
      <% if @question.question_type == 'choose' then%>
        <%= form_with(url: "/recommend/" + params[:id].to_s, method: :get, local: true) do |form| %>
          <%= form.label :choice, "Select your answer here:", :class=>"col-lg-12 col-form-label col-form-label-lg padding" %>
          <%= form.select :choice, @options, {}, :class=>"form-control" %>
          <%= form.label :location, "Place:", :class=>"col-lg-12 col-form-label col-form-label-lg padding" %>
          <%= form.text_field :location, :id => 'recommend_location',:class=>"form-control insert-location" %>
          <%= form.submit "Recommend:" , :class=>"btn btn-primary" %>
        <% end %>
      <% elsif @question.question_type == 'fill' %>
        <%= form_with(url: "/recommend/" + params[:id].to_s, method: :get, local: true) do |form| %>
          <%= form.label :choice, "Input your answer here:", :class=>"col-lg-12 col-form-label col-form-label-lg padding" %>
          <%= form.text_field :choice, :class=>"form-control" %>
          <%= form.label :location, "Place:", :class=>"col-lg-12 col-form-label col-form-label-lg padding" %>
          <%= form.text_field :location, :class=>"form-control insert-location" %>
          <%= form.submit "Recommend:" , :class=>"btn btn-primary" %>
        <% end %>
      <% end %>
      </div>

     
    </div>
  </div>
</div>


<!-- The Modal -->
<div class="modal fade" id="eventModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Search</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <%= form_with(url: "/event/" + params[:id].to_s, method: :get, local: true) do |form| %>
          <%= form.label :location, "Location:", :class=>"col-lg-12 col-form-label col-form-label-lg padding" %>
          <%= form.text_field :location, :class=>"form-control insert-location" %>
          <%= form.submit "Find" , :class=>"btn btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>


<span class="likebtn-wrapper" data-theme="review" data-white_label="true" data-identifier="item_1"></span>


<footer class="py-5" style="margin-top:100px; background-color:rgb(238 9 120)">
    <div class="container">
      <p class="m-0 text-center text-white small">Copyright &copy; Pokemon Eat 2021</p>
    </div>
</footer>




<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://js.api.here.com/v3/3.1/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
<script src="https://js.api.here.com/v3/3.1/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
<script>
  var getLocation = function(callback) {
    console.log("1");
    var platform = new H.service.Platform({
        "apikey": "E9KedL51q-cXtnB-wozFyrcK92qCagiCQ9f0ETVx114"
    });
    var geocoder = platform.getSearchService();
    var loc;
    console.log("2");
    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            geocoder.reverseGeocode(
                {
                  limit: 1,
                  at: position.coords.latitude + "," + position.coords.longitude
                }, data => {
                  loc = data["items"][0]["title"];
                  console.log(loc);
                  insertLocation(loc);
                }, error => {
                  console.error(error);
                }
            );
        });
    } else {
        console.error("Geolocation is not supported by this browser!");
    }
    callback();
  }
  
  var insertLocation = function(loc){
    $('.insert-location').val(loc);
    console.log("4");
  }
  getLocation(insertLocation);
</script>

<script>
(function(d,e,s){
  if(d.getElementById("likebtn_wjs"))return;
  
  a=d.createElement(e);
  m=d.getElementsByTagName(e)[0];
  a.async=1;
  a.id="likebtn_wjs";
  a.src=s;
  m.parentNode.insertBefore(a, m)
})(document,"script","//w.likebtn.com/js/w/widget.js");
</script>
